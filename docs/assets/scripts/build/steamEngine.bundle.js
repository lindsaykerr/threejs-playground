"use strict";(self.webpackChunkthreejs_playground=self.webpackChunkthreejs_playground||[]).push([[414],{49:(e,t,i)=>{var a=i(477);const n={viewer:{width:window.innerWidth,height:window.innerHeight},sceneAssets:{loaded:!1},animations:{},animationControls:{engineRunning:!1,currentTimeScale:0,animationRunning:!1},scene:{Obj:{},envMap:void 0},lighting:{windowA:{lightObject:void 0,lightHelper:void 0},windowB:{lightObject:void 0,lightHelper:void 0},spotlightA:{lightObject:void 0,lightHelper:void 0,position:void 0,target:void 0,shadowHelper:void 0},spotlightB:{lightObject:void 0,lightHelper:void 0,position:void 0,target:void 0,shadowHelper:void 0}},camera:{obj:void 0,helper:void 0,target:{x:0,y:0,z:0}}},s={renderer:{parameters:{antialias:!0,precision:"highp"},shadowMap:{enabled:!0,type:a.ntZ},outputEncoding:a.knz,toneMapping:a.dZ3,toneMappingExposure:1},animations:{flywheelHandle:"flywheelCycle",mainPistonArmature:"mainPistonCycle",valvePistonArmature:"valvePistonCycle"},lighting:{areaLightA:{position:[-7,2,3],target:[-7,0,0],settings:{colour:15465983,intensity:5,areaHeight:2,areaWidth:3}},areaLightB:{position:[0,2,3],target:[0,0,0],settings:{colour:15465983,intensity:5,areaHeight:2,areaWidth:3}},spotlightA:{position:[-.8,8,0],target:[-.8,0,0],lightProperties:{colour:16639638,intensity:7,distance:25,angle:.12*Math.PI,penumbra:.5,decay:1},shadowProperties:{width:512,height:512,far:10,near:2,bias:-.02,fov:20}},spotlightB:{position:[-6,8,1],target:[-6,0,1],lightProperties:{colour:16639638,intensity:7,distance:25,angle:.12*Math.PI,penumbra:.5,decay:1},shadowProperties:{width:512,height:512,far:10,near:2,bias:-.02,fov:20}}},scene:{envMapIntensity:.5},camera:{fov:40,aspect:n.viewer.width/n.viewer.height,near:.1,far:120}};class o extends a.x12{constructor(e,t){const i=new a.u9r;i.setAttribute("position",new a.a$l([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new a.nls({fog:!1})),this.light=e,this.color=t,this.type="RectAreaLightHelper";const n=new a.u9r;n.setAttribute("position",new a.a$l([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new a.Kj0(n,new a.vBJ({side:a._Li,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}class r{constructor(e,t,i){return this.light=new a.T_f(e.colour,e.intensity,e.areaHeight,e.areaWidth),this.light.position.set(...t),this.light.lookAt(new a.Pa4(...i)),this.helper=new o(this.light),this}helperOn(){this.helper.visible=!0}helperOff(){this.helper.visible=!1}}class l{constructor(e,t,i){return this.light=new a.PMe(e.colour,e.intensity,e.distance,e.angle,e.penumbra,e.decay),this.light.position.set(...t),this.light.target.position.set(...i),this.helper=new a.Rki(this.light.shadow.camera),this}shadow(e){return this.light.shadow.mapSize.width=e.width,this.light.shadow.mapSize.height=e.height,this.light.shadow.camera.near=e.near,this.light.shadow.camera.far=e.far,this.light.shadow.bias=e.bias,this.light.shadow.camera.fov=e.fov,this}shadowOn(){this.light.castShadow=!0}shadowOff(){this.light.castShadow=!1}helperOn(){this.helper.visible=!0}helperOff(){this.helper.visible=!1}}const h=i.p+"assets/images/944c3be3309699e0093b.png",c=i.p+"assets/images/1364bc0f21b5cbb328b7.png",g=i.p+"assets/images/fccdd71d39315cccb423.png",p=i.p+"assets/images/c3771ec1ac2d053dc025.png",d=i.p+"assets/images/013ed18b17c8e737ddff.png",m=i.p+"assets/images/02d5546be4a55abe8072.png";var w=i(217);const u=i.p+"assets/gltf/2852f91da548200fcdda.glb";class v{constructor(e){if(e instanceof a.Tme==0)throw Error("targetObj is not instance of THREE.Object3D");this.target=e,this.mixer=new a.Xcj(e),this.clipActions={}}addClipAction(e,t){this.clipActions[t]=this.mixer.clipAction(a.m7l.findByName(e,t))}playClipAction(e){this.clipActions[e].play()}getClipAction(e){return this.clipActions[e]}update(e){this.mixer.update(e)}}var y=i(637);let A;const b=document.querySelector(".viewer-3d");(()=>{const e=(new a.cBK).load([c,h,p,g,m,d]);return n.scene.envMap=e,e})().encoding=a.knz,window.addEventListener("resize",(e=>{const t=e.target.innerWidth,i=e.target.innerHeight;n.viewer.width=t,n.viewer.height=i,(()=>{const e=t/i;f.camera.left=-5*e,f.camera.right=5*e,f.camera.updateProjectionMatrix()})(),C.setSize(t,i),C.render(A,f.camera)})),(new class{constructor(){this.scene=new a.xsS}setAsMain(){n.scene.Obj=this.scene}}).setAsMain(),A=n.scene.Obj,(new w.E).load(u,(e=>{const t=(t,i)=>{const a=new v(e.scene.getObjectByName(t));a.addClipAction(e.animations,i),n.animations[t]=a};for(let e in s.animations)t(e,s.animations[e]);e.scene.scale.set(2,2,2),e.scene.traverse((e=>{e instanceof a.Kj0&&(e.castShadow=!0,e.receiveShadow=!0,e.material instanceof a.Wid&&(e.material.envMap=n.scene?.envMap,e.material.envMapIntensity=s.scene?.envMapIntensity))})),n.scene?.Obj.add(e.scene),n.sceneAssets.loaded=!0})),(()=>{const e=s.lighting,t=n.scene.Obj,i=new a.ZAu;i.name="lighting";const o=new r(e.areaLightA.settings,e.areaLightA.position,e.areaLightA.target),h=new r(e.areaLightB.settings,e.areaLightB.position,e.areaLightB.target),c=new l(e.spotlightA.lightProperties,e.spotlightA.position,e.spotlightA.target).shadow(e.spotlightA.shadowProperties),g=new l(e.spotlightB.lightProperties,e.spotlightB.position,e.spotlightB.target).shadow(e.spotlightB.shadowProperties);o.helperOff(),h.helperOff(),c.shadowOn(),c.helperOff(),g.shadowOn(),g.helperOff(),i.add(o.light,o.helper),n.lighting.windowA.lightObject=o.light,n.lighting.windowA.lightHelper=o.helper,i.add(h.light,h.helper),n.lighting.windowB.lightObject=h.light,n.lighting.windowB.lightHelper=h.helper,i.add(c.light,c.helper,c.light.target),n.lighting.spotlightA.lightObject=c.light,n.lighting.spotlightA.lightHelper=c.helper,n.lighting.spotlightA.position=c.light.position.toArray,n.lighting.spotlightA.target=c.light.target,i.add(g.light,g.helper,g.light.target),n.lighting.spotlightB.lightObject=g.light,n.lighting.spotlightB.lightHelper=g.helper,n.lighting.spotlightB.position=g.light.position.toArray,n.lighting.spotlightB.target=g.light.target,t.add(i)})();const f=new class extends class{constructor(e,t){this.position=e,this.target=t}}{constructor(e,t,i,s,o,r,l){super(o,r);const h=.5*e,c=.5*t,g=n.viewer.width/n.viewer.height;this.camera=new a.iKG(-h*g,h*g,c,-c,i,s),l&&(this.camera.name=l),this.camera.position.set(...o),this.camera.lookAt(...r),this.helper=new a.Rki(this.camera),n.scene.Obj&&n.scene.Obj.add(this.helper),this.helper.visible=!1}positionCamera(e){this.position=e,this.camera.position.set(...this.position)}lookingAt(e){this.target=e,this.camera.lookAt(...this.target)}helperOn(){this.helper.visible=!0}helperOff(){this.helper.visible=!1}}(10,10,.1,20,[-10,4,6],[0,0,0]);f.helperOn(),n.camera.obj=f.camera,n.camera.helper=f.helper;const C=((e,t,i)=>{const o=new a.CP7({canvas:e,...s.renderer.parameters});return o.setSize(n.viewer.width,n.viewer.height),o.setPixelRatio(1.5*Math.min(window.devicePixelRatio,2)),o.render(t,i),o.shadowMap.enabled=s.renderer.shadowMap.enabled,o.shadowMap.type=s.renderer.shadowMap.type,o.outputEncoding=s.renderer.outputEncoding,o.toneMapping=s.renderer.toneMapping,o.toneMappingExposure=s.renderer.toneMappingExposure,o})(b,n.scene.Obj,f.camera),P=n.animations;console.log(P);const j=new a.SUY;let O="";j.getDelta(),function e(t){n.sceneAssets.loaded||setTimeout(e,100),t&&t()}((()=>{(()=>{const e=new y.XS,t=e.addFolder("Camera");t.add(n.camera.target,"x",-10,10,.1).name("lookAt x").onChange((()=>{n.camera.obj.lookAt(n.camera.target.x,n.camera.target.y,n.camera.target.z),n.camera.obj.updateProjectionMatrix()})),t.add(n.camera.target,"y",-10,10,.1).name("lookAt y").onChange((()=>{n.camera.obj.lookAt(n.camera.target.x,n.camera.target.y,n.camera.target.z),n.camera.obj.updateProjectionMatrix()})),t.add(n.camera.target,"z",-10,10,.1).name("lookAt z").onChange((()=>{n.camera.obj.lookAt(n.camera.target.x,n.camera.target.y,n.camera.target.z),n.camera.obj.updateProjectionMatrix()})),t.add(n.camera.helper,"visible"),t.add(n.camera.obj.position,"x",-10,10,.1),t.add(n.camera.obj.position,"y",-10,10,.1),t.add(n.camera.obj.position,"z",-10,10,.1),e.addFolder("Engine Controls").add(n.animationControls,"engineRunning").name("Run Engine")})();const e=()=>{const t=j.getDelta(),i=P.flywheelHandle?.getClipAction("flywheelCycle");i?.getEffectiveTimeScale(),n.animationControls.engineRunning?(console.log("in"),"running"!==O&&(((e,t)=>{const i=P.flywheelHandle?.getClipAction("flywheelCycle");i?.warp(0,1.5,20);const a=P.mainPistonArmature?.getClipAction("mainPistonCycle");a?.syncWith(i).warp(0,1.5,20);const n=P.valvePistonArmature?.getClipAction("valvePistonCycle");n?.syncWith(i).warp(0,1.5,20)})(),P.flywheelHandle?.getClipAction("flywheelCycle").play(),P.mainPistonArmature?.getClipAction("mainPistonCycle").play(),P.valvePistonArmature?.getClipAction("valvePistonCycle").play(),O="running")):("running"===O&&((e=>{const t=P.flywheelHandle?.getClipAction("flywheelCycle");t?.halt(10);const i=P.mainPistonArmature?.getClipAction("mainPistonCycle");i?.halt(10);const a=P.valvePistonArmature?.getClipAction("valvePistonCycle");a?.halt(10)})(),O="stopping"),i?.isRunning()||(P.flywheelHandle?.getClipAction("flywheelCycle").stop(),P.mainPistonArmature?.getClipAction("mainPistonCycle").stop(),P.valvePistonArmature?.getClipAction("valvePistonCycle").stop()));for(const e in P)P[e].update(t);C.render(A,f.camera),requestAnimationFrame(e)};e()}))}},e=>{e.O(0,[217,841,929],(()=>(49,e(e.s=49)))),e.O()}]);